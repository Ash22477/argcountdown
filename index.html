<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LYRA</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

    body {
      margin: 0;
      background: #000;
      color: #00ffcc;
      font-family: 'Share Tech Mono', monospace;
      overflow: hidden;
      height: 100vh;
      position: relative;
    }

    .grain {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-image: url('https://www.transparenttextures.com/patterns/asfalt-dark.png');
      opacity: 0.05;
      z-index: 1;
    }

    .lamp {
      position: absolute;
      bottom: 20px;
      right: 30px;
      width: 15px;
      height: 15px;
      background: #ffff99;
      border-radius: 50%;
      opacity: 0;
      box-shadow: 0 0 10px #ffff99aa;
      z-index: 2;
    }

    .terminal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 3;
    }

    .terminal p {
      font-size: 1.5rem;
      color: #00ffcc;
      margin: 0 0 20px;
      opacity: 0.8;
    }

    #code-input {
      background: transparent;
      border: none;
      border-bottom: 2px solid #00ffcc;
      color: #00ffcc;
      font-size: 2rem;
      text-align: center;
      outline: none;
      width: 80px;
      caret-color: #00ffcc;
      animation: blinkCaret 1s infinite;
    }

    @keyframes blinkCaret {
      0%, 49% { border-bottom-color: #00ffcc; }
      50%, 100% { border-bottom-color: transparent; }
    }

    #code-input:hover {
      text-shadow: 0 0 5px #ff00ff;
    }

    .clouds {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 300%;
      height: 200px;
      background: url('https://i.imgur.com/2l6g7Yq.png') repeat-x;
      background-size: contain;
      animation: moveClouds 60s linear infinite;
      z-index: 0;
      opacity: 0.4;
    }

    @keyframes moveClouds {
      from { transform: translateX(0); }
      to { transform: translateX(-50%); }
    }

    .weather-button {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 1rem;
      background: #111;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      cursor: pointer;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="clouds" id="clouds"></div>
  <div class="grain"></div>
  <div class="lamp" id="lamp"></div>

  <div class="terminal" id="login-screen">
    <p>ACCESS CODE:</p>
    <input type="text" id="code-input" maxlength="3" autocomplete="off" />
  </div>

  <div class="terminal hidden" id="error-screen">
    <p>Error 404: Memory not found.</p>
    <button class="weather-button" onclick="beginCountdown()">Refresh</button>
  </div>

  <div class="terminal hidden" id="countdown-screen">
    <h1 id="countdown"></h1>
    <p>Good things come to those who wait.</p>
    <button class="weather-button" onclick="cycleWeather()">Weather Mode</button>
  </div>
  <audio id="bg-music" src="https://ash22477.github.io/argcountdown/musical_morse_synced_full.mp3" muted loop></audio>

  <script>
    const input = document.getElementById("code-input");
    const login = document.getElementById("login-screen");
    const error = document.getElementById("error-screen");
    const countdownScreen = document.getElementById("countdown-screen");
    const clouds = document.getElementById("clouds");
    const lamp = document.getElementById("lamp");
    const music = document.getElementById("bg-music");

    // Morse settings
    const DOT = 300, DASH = 900, SYMBOL_PAUSE = 200, LETTER_PAUSE = 500, WORD_PAUSE = 1200;

    function delay(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    async function blinkMorse(message) {
      const words = message.split(" / ");
      for (let word of words) {
        const letters = word.split(" ");
        for (let letter of letters) {
          for (let char of letter) {
            lamp.style.opacity = 1;
            await delay(char === "." ? DOT : DASH);
            lamp.style.opacity = 0;
            await delay(SYMBOL_PAUSE);
          }
          await delay(LETTER_PAUSE);
        }
        await delay(WORD_PAUSE);
      }
    }

    function playMorseLoop(msg) {
      (async function loop() {
        while (true) await blinkMorse(msg);
      })();
    }

    let morsePhase = "start"; // start: 404 / after: "solve this"

    // Trigger music & first Morse after interaction
    window.addEventListener("click", () => {
      music.muted = false;
      music.play();
      if (morsePhase === "start") {
        playMorseLoop("..-. --- ..- .-. / --- / ..-. --- ..- .-.");
      }
    }, { once: true });

    // Puzzle input logic
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        if (input.value === "404") {
          login.classList.add("hidden");
          error.classList.remove("hidden");
        }
      }
    });

    function beginCountdown() {
      error.classList.add("hidden");
      countdownScreen.classList.remove("hidden");
      clouds.style.display = "block";
      morsePhase = "after";
      playMorseLoop("-.-- --- ..- .----. .-. . / ... -- .- .-. - --..-- / ... --- .-.. ...- . / - .... .. ... / .--. ..- --.. --.. .-.. .");
      startCountdown();
    }

    function startCountdown() {
      const countdown = document.getElementById("countdown");
      const target = new Date("2025-02-09T00:00:00+04:00").getTime();
      const interval = setInterval(() => {
        const now = new Date().getTime();
        const diff = target - now;
        if (diff <= 0) {
          clearInterval(interval);
          countdown.innerText = "Itâ€™s time.";
          return;
        }
        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);
        countdown.innerText = `${d}d ${h}h ${m}m ${s}s`;
      }, 1000);
    }

    let weatherState = 0;
    function cycleWeather() {
      weatherState = (weatherState + 1) % 5;
      switch (weatherState) {
        case 0: clouds.style.animationDuration = "60s"; break;
        case 1: clouds.style.animationDuration = "30s"; break;
        case 2: clouds.style.animationDuration = "15s"; break;
        case 3: rainCatsAndDogs(); break;
        case 4: clouds.style.animationDuration = "60s"; break;
      }
    }

    function rainCatsAndDogs() {
      const symbols = ["ðŸ±", "ðŸ¶"];
      for (let i = 0; i < 10; i++) {
        const el = document.createElement("div");
        el.textContent = symbols[Math.floor(Math.random() * symbols.length)];
        el.style.position = "absolute";
        el.style.top = "-40px";
        el.style.left = Math.random() * 100 + "vw";
        el.style.fontSize = "28px";
        el.style.zIndex = "10";
        el.style.animation = "fall 4s linear forwards";
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 4000);
      }
    }

    // Falling animation
    const style = document.createElement('style');
    style.innerHTML = `@keyframes fall { 0%{transform:translateY(0);opacity:1;} 100%{transform:translateY(100vh);opacity:0;} }`;
    document.head.appendChild(style);
  </script>
</body>
</html>
